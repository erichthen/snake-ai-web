<!DOCTYPE html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Snake: ML model</title>
    <link rel="stylesheet" href="style.css">
    <!-- loads socket.io client lib,   -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/3.1.3/socket.io.js"></script>
</head>
<body>
    <h1>Snake Game –– Reinforcement Learning</h1>
    <button id="start-button">Start Training</button>
    <div id="game-window"> 
        <canvas id="game-canvas" width="640" height="480"></canvas>
    </div>
    <div id ="plot-container" style="display:none;">
        <img id="plot" src="" alt="Training Progress">
    <script>

        //initialize connection 
        const socket = io();
        const canvas = document.getElementById('game-canvas');
        const ctx = canvas.getContext('2d');

        document.getElementById('start-button').onclick = function() {
            fetch('/start_game', {
                method: 'POST' //post request to start the game
            })
            .then(response => response.json()) //process feedback
            .then(data => {
                if (data.status === 'Training started') {
                    console.log('Training Started');                
                }
            });
        };

        //listen for frame updates
        socket.on('frame_update', function(data) {
            const image = new Image();
            image.onload = function() {
                ctx.drawImage(image, 0, 0, canvas.width, canvas.height);
            };
            image.src = 'data:image/png;base64,' + data.frame;
        });

        //listen for game updates
        socket.on('game_update', function(data) {
            document.getElementById('score').innerText = 'Score: ' + data.score;
            document.getElementById('record').innerText = 'Record: ' + data.record;
            document.getElementById('plot').src = 'data:image/png;base64,' + data.plot;
            document.getElementById('plot-container').style.display = 'block';
        });

    </script>
    </div>
</body>
</html>